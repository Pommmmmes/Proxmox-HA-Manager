{"version":3,"file":"grid-detail.element.js","sources":["../../../../src/grid/detail/grid-detail.element.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\nimport { __decorate } from \"tslib\";\nimport { html, LitElement } from 'lit';\nimport { baseStyles, i18n, I18nService, property, ResponsiveController, state, listenForAttributeChange, propUpdated, renderAfter, ariaModal, firstFocus, focusTrap, ariaPopup, layer, closable, triggerable, } from '@cds/core/internal';\nimport styles from './grid-detail.element.scss';\n/**\n * Grid Detail\n *\n * ```typescript\n * import '@cds/core/grid/register.js';\n * ```\n *\n * @internal\n * @element cds-grid-detail\n * @event closeChange\n * @csspart close\n * @cssprop --width\n * @cssprop --inset-inline-start\n * @cssprop --inset-inline-end\n * @cssprop --backdrop-background\n */\nlet CdsGridDetail = class CdsGridDetail extends LitElement {\n    constructor() {\n        super(...arguments);\n        this.position = 'right';\n        this.i18n = I18nService.keys.grid;\n        this.overlay = '';\n        this.responsiveController = new ResponsiveController(this, { element: this.parentElement });\n    }\n    get grid() {\n        return this.parentElement;\n    }\n    get trigger() {\n        return typeof this.anchor === 'string'\n            ? this.getRootNode().querySelector(`#${this.anchor}`)\n            : this.anchor;\n    }\n    get closeButton() {\n        // safari https://bugs.webkit.org/show_bug.cgi?id=174667\n        return html ` <cds-button-action\n      @click=${() => this.closableController.close()}\n      shape=\"times\"\n      aria-label=${this.i18n.closeDetails}\n      part=\"close\"\n    ></cds-button-action>`;\n    }\n    get triggerRow() {\n        return this.trigger?.closest('cds-grid-row');\n    }\n    render() {\n        return html `<div class=\"private-host\" role=\"presentation\">\n        <div cds-layout=\"display:screen-reader-only\">${this.i18n.rowDetailStart}</div>\n        <slot></slot>\n\n        <div cds-layout=\"display:screen-reader-only\">${this.i18n.rowDetailEnd}</div>\n      </div>\n      <div class=\"caret\" role=\"presentation\"></div>`;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.slot = 'detail';\n        renderAfter(this.closeButton, this);\n        this.addEventListener('cdsResizeChange', (e) => (this.overlay = e.detail.width > 500 ? '' : 'full'));\n        this.observer = listenForAttributeChange(this, 'hidden', async (hidden) => {\n            this.grid.scrollLock = !hidden;\n            await this.updateComplete;\n            this.setDetailWidthAlignment();\n            this.toggleAnchorHover();\n        });\n    }\n    async updated(props) {\n        super.updated(props);\n        await this.updateComplete;\n        if (propUpdated(this, props, 'anchor')) {\n            this.setAnchorPointer(props.get('anchor'));\n        }\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        this.observer?.disconnect();\n        this.triggerRow?.removeAttribute('_detail-row');\n    }\n    toggleAnchorHover() {\n        if (this.hidden) {\n            this.triggerRow?.removeAttribute('_detail-row');\n        }\n        else {\n            this.triggerRow?.setAttribute('_detail-row', '');\n        }\n    }\n    setAnchorPointer(previousAnchor) {\n        if (previousAnchor?.closest) {\n            previousAnchor?.closest('cds-grid-row')?.removeAttribute('_detail-row');\n        }\n        this.toggleAnchorHover();\n        const top = this.trigger?.getBoundingClientRect()?.top - this?.getBoundingClientRect().top - 8;\n        this.style.setProperty('--caret-top', `${top}px`);\n    }\n    setDetailWidthAlignment() {\n        if (this.position === 'bottom') {\n            this.alignToBottom();\n        }\n        const rowheader = Array.from(this.triggerRow?.cells ?? []).find(c => c.role === 'rowheader');\n        if (rowheader) {\n            this.alignToSide(rowheader);\n        }\n    }\n    alignToBottom() {\n        const gridRect = this.parentElement?.getBoundingClientRect();\n        const rowRect = this.triggerRow?.getBoundingClientRect();\n        this.style.setProperty('--width', '100%');\n        if (this.position === 'bottom' && rowRect) {\n            this.style.top = `${rowRect?.bottom - gridRect.top - 1}px`;\n        }\n    }\n    alignToSide(rowheader) {\n        const gridRect = this.parentElement?.getBoundingClientRect();\n        const cellRect = rowheader.getBoundingClientRect();\n        this.style.setProperty('--width', 'auto');\n        if (this.position === 'left' || this.parentElement?.getAttribute('dir') === 'rtl') {\n            this.style.right = `${gridRect.right - cellRect.left}px`;\n        }\n        else {\n            this.style.left = `${cellRect.right - gridRect.left}px`;\n        }\n    }\n};\nCdsGridDetail.styles = [baseStyles, styles];\n__decorate([\n    property({ type: String })\n], CdsGridDetail.prototype, \"anchor\", void 0);\n__decorate([\n    property({ type: String })\n], CdsGridDetail.prototype, \"position\", void 0);\n__decorate([\n    i18n()\n], CdsGridDetail.prototype, \"i18n\", void 0);\n__decorate([\n    state({ type: String, reflect: true })\n], CdsGridDetail.prototype, \"overlay\", void 0);\nCdsGridDetail = __decorate([\n    layer(),\n    closable(),\n    ariaModal(),\n    ariaPopup(),\n    focusTrap(),\n    firstFocus(),\n    triggerable()\n], CdsGridDetail);\nexport { CdsGridDetail };\n"],"names":["CdsGridDetail","LitElement","constructor","super","this","position","i18n","I18nService","keys","grid","overlay","responsiveController","ResponsiveController","element","parentElement","trigger","anchor","getRootNode","querySelector","closeButton","html","closableController","close","closeDetails","triggerRow","closest","render","rowDetailStart","rowDetailEnd","connectedCallback","slot","renderAfter","addEventListener","e","detail","width","observer","listenForAttributeChange","async","hidden","scrollLock","updateComplete","setDetailWidthAlignment","toggleAnchorHover","props","updated","propUpdated","setAnchorPointer","get","disconnectedCallback","disconnect","removeAttribute","setAttribute","previousAnchor","top","getBoundingClientRect","style","setProperty","alignToBottom","rowheader","Array","from","cells","find","c","role","alignToSide","gridRect","rowRect","bottom","cellRect","getAttribute","right","left","styles","baseStyles","__decorate","property","type","String","prototype","state","reflect","layer","closable","ariaModal","ariaPopup","focusTrap","firstFocus","triggerable"],"mappings":"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"}