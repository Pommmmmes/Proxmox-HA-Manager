{"version":3,"file":"popup.element.js","sources":["../../../../src/internal-components/popup/popup.element.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\nimport { __decorate } from \"tslib\";\nimport { animate, AnimationResponsivePopupEnterName, baseStyles, event, getElementUpdates, i18n, I18nService, isScrollable, property, querySlot, reverseAnimation, setAttributes, setPopupPosition, state, ariaPopup, } from '@cds/core/internal';\nimport { html } from 'lit';\nimport { query } from 'lit/decorators/query.js';\nimport { CdsInternalStaticOverlay } from '@cds/core/internal-components/overlay';\nimport sharedStyles from '../overlay/shared.element.scss';\nimport styles from './popup.element.scss';\n/**\n * ```typescript\n * import '@cds/core/internal-components/popup/register.js';\n * ```\n *\n * ```html\n * <cds-internal-popup>\n *  <section cds-layout=\"vertical align:horizontal-stretch\">\n *    <div cds-layout=\"vertical pad:md gap:md\">\n *      <h2 cds-text=\"display\">A Title</h2>\n *      <div>\n *        <p cds-text=\"body\">\n *          Content inside a generic popup.\n *        </p>\n *      </div>\n *    </div>\n *  </section>\n * </cds-internal-popup>\n * ```\n *\n * @beta\n * @element cds-internal-popup\n * @slot - Content slot for the content inside the popup's panel\n * @event closeChange - Notify user when close event has occurred\n * @cssprop --active-corner-border-radius\n * @cssprop --background\n * @cssprop --backdrop-background\n * @cssprop --layered-backdrop-background\n * @cssprop --border-color\n * @cssprop --border-radius\n * @cssprop --border-width\n * @cssprop --box-shadow\n * @cssprop --close-button-offset\n * @cssprop --color\n * @cssprop --min-height\n * @cssprop --min-width\n * @cssprop --max-height\n * @cssprop --max-width\n * @cssprop --mobile-max-height\n * @cssprop --overflow - sets overflow x and y values respectively\n * @cssprop --height\n * @cssprop --width\n * @cssprop --animation-duration\n * @cssprop --animation-easing\n *\n * KNOWN ISSUE: Safari jumps through the exit animation but only when the ESC key is pressed.\n *\n */\nlet CdsInternalPopup = class CdsInternalPopup extends CdsInternalStaticOverlay {\n    constructor() {\n        // --- mixins/composables ---\n        super(...arguments);\n        this.i18n = I18nService.keys.popup;\n        this.cdsMotion = 'on';\n        /**\n         * force responsive by setting orientation to 'none'.\n         * do not manipulate the responsive property because the\n         * positioning logic may override your changes.\n         */\n        /** @private */\n        this.responsive = false;\n        this.anchorAlign = 'start';\n        // --- pointer ---\n        this.pointerAlign = 'start';\n        // TODO: TESTME\n        /**\n         * Forces a pointer to show with popup from known pointer types\n         * @type {'angle' | 'default'}\n         */\n        this.defaultPointerType = null;\n        // --- observers and callbacks ---\n        this.observers = [];\n    }\n    // this getter is stealth private so we can test it in isolation\n    /** @private */\n    get anchorElement() {\n        const anchor = this.anchor;\n        // if string we have an id\n        if (typeof anchor === 'string') {\n            // check shadowRoot first in the event that we have a wrapper web component\n            const shadowAnchor = this.getRootNode().querySelector(`#${anchor}`);\n            if (shadowAnchor === null) {\n                // check document/light-dom next; lookup below returns an element or null\n                return this.getRootNode({ composed: true }).querySelector(`#${this.anchor}`);\n            }\n            else {\n                return shadowAnchor;\n            }\n        }\n        // anchor is not an id/string; so return whatever it is\n        return anchor;\n    }\n    /** @private */\n    get anchorRect() {\n        return this.anchorElement?.getBoundingClientRect() || new DOMRect();\n    }\n    setUpPositioningObserver() {\n        this.observers.push(getElementUpdates(this, 'hidden', () => {\n            if (this.hidden === false) {\n                setPopupPosition(this);\n            }\n        }));\n    }\n    connectedCallback() {\n        if (!this.pointer && this.defaultPointerType) {\n            const defaultPointer = document.createElement('cds-internal-pointer');\n            defaultPointer.type = this.defaultPointerType;\n            this.appendChild(defaultPointer);\n        }\n        super.connectedCallback();\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        this.observers.forEach(o => o?.disconnect());\n    }\n    // --- lifecycle ---\n    firstUpdated(props) {\n        super.firstUpdated(props);\n        this.setUpPositioningObserver();\n    }\n    updated(props) {\n        if (this.pointer && !this.pointer.hasAttribute('part')) {\n            setAttributes(this.pointer, ['part', 'pointer']);\n        }\n        if (props.has('hidden')) {\n            setAttributes(this.contentWrapper, ['tabindex', isScrollable(this.contentWrapper) ? '0' : false]);\n        }\n        super.updated(props);\n    }\n    // --- render and styles ---\n    render() {\n        return html `\n      ${this.backdropTemplate}\n      <div class=\"private-host\" tabindex=\"-1\">\n        <div cds-layout=\"display:screen-reader-only\">${this.i18n.contentStart}</div>\n        <div class=\"popup-wrapper\">\n          <div class=\"popup-content\">\n            ${this.closable || this.responsive ? this.closeButtonTemplate : ''}\n            <slot></slot>\n          </div>\n          <div class=\"pointer-wrapper\">\n            <div class=\"popup-pointer\"><slot name=\"pointer\"></slot></div>\n          </div>\n        </div>\n        <div cds-layout=\"display:screen-reader-only\">${this.i18n.contentEnd}</div>\n      </div>\n    `;\n    }\n    static get styles() {\n        return [baseStyles, styles, sharedStyles];\n    }\n};\n__decorate([\n    i18n()\n], CdsInternalPopup.prototype, \"i18n\", void 0);\n__decorate([\n    property({ type: String })\n], CdsInternalPopup.prototype, \"cdsMotion\", void 0);\n__decorate([\n    state({ type: Boolean, reflect: true, attribute: 'responsive' })\n], CdsInternalPopup.prototype, \"responsive\", void 0);\n__decorate([\n    event()\n], CdsInternalPopup.prototype, \"cdsMotionChange\", void 0);\n__decorate([\n    property({ type: Object })\n], CdsInternalPopup.prototype, \"trigger\", void 0);\n__decorate([\n    property({ type: String })\n], CdsInternalPopup.prototype, \"anchor\", void 0);\n__decorate([\n    property({ type: String })\n], CdsInternalPopup.prototype, \"anchorAlign\", void 0);\n__decorate([\n    property({ type: Number })\n], CdsInternalPopup.prototype, \"mainAxisOffset\", void 0);\n__decorate([\n    property({ type: Number })\n], CdsInternalPopup.prototype, \"crossAxisOffset\", void 0);\n__decorate([\n    property({ type: String })\n], CdsInternalPopup.prototype, \"orientation\", void 0);\n__decorate([\n    property({ type: Boolean })\n], CdsInternalPopup.prototype, \"closable\", void 0);\n__decorate([\n    property({ type: String })\n], CdsInternalPopup.prototype, \"pointerAlign\", void 0);\n__decorate([\n    property({ type: String })\n], CdsInternalPopup.prototype, \"defaultPointerType\", void 0);\n__decorate([\n    querySlot('cds-internal-pointer', { assign: 'pointer' })\n], CdsInternalPopup.prototype, \"pointer\", void 0);\n__decorate([\n    query('.popup-pointer')\n], CdsInternalPopup.prototype, \"pointerWrapper\", void 0);\n__decorate([\n    query('.private-host')\n], CdsInternalPopup.prototype, \"hostWrapper\", void 0);\n__decorate([\n    query('.popup-wrapper')\n], CdsInternalPopup.prototype, \"popupWrapper\", void 0);\n__decorate([\n    query('.popup-content')\n], CdsInternalPopup.prototype, \"contentWrapper\", void 0);\nCdsInternalPopup = __decorate([\n    ariaPopup(),\n    animate({\n        hidden: {\n            true: reverseAnimation(AnimationResponsivePopupEnterName),\n            false: AnimationResponsivePopupEnterName,\n        },\n    })\n], CdsInternalPopup);\nexport { CdsInternalPopup };\n"],"names":["CdsInternalPopup","CdsInternalStaticOverlay","constructor","super","this","i18n","I18nService","keys","popup","cdsMotion","responsive","anchorAlign","pointerAlign","defaultPointerType","observers","anchorElement","anchor","shadowAnchor","getRootNode","querySelector","composed","anchorRect","getBoundingClientRect","DOMRect","setUpPositioningObserver","push","getElementUpdates","hidden","setPopupPosition","connectedCallback","pointer","defaultPointer","document","createElement","type","appendChild","disconnectedCallback","forEach","o","disconnect","firstUpdated","props","updated","hasAttribute","setAttributes","has","contentWrapper","isScrollable","render","html","backdropTemplate","contentStart","closable","closeButtonTemplate","contentEnd","styles","baseStyles","sharedStyles","__decorate","prototype","property","String","state","Boolean","reflect","attribute","event","Object","Number","querySlot","assign","query","ariaPopup","animate","true","reverseAnimation","AnimationResponsivePopupEnterName","false"],"mappings":"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"}