{"version":3,"file":"grid-range-selection.controller.js","sources":["../../../../src/internal/controllers/grid-range-selection.controller.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\n/**\n * Given a 2d array grid structure provide a highlight/range selection of given cells\n */\nexport function gridRangeSelection() {\n    return (target) => target.addInitializer((instance) => new GridRangeSelectionController(instance));\n}\nexport class GridRangeSelectionController {\n    constructor(host) {\n        this.host = host;\n        this.selectionActive = false;\n        host.addController(this);\n    }\n    get enabled() {\n        return this.host.rangeSelection !== false && !Array.from(this.host.rows).find(r => r.draggable);\n    }\n    async hostConnected() {\n        await this.host.updateComplete;\n        this.setupKeyboardListeners();\n        this.setupMouseEvents();\n    }\n    setupMouseEvents() {\n        const root = this.host.grid.shadowRoot ? this.host.grid.shadowRoot : this.host.grid;\n        root.addEventListener('mousedown', (e) => {\n            // preserve right click for context menus & keyboard mouse control https://apple.stackexchange.com/questions/32715/how-do-i-open-the-context-menu-from-a-mac-keyboard\n            if (this.enabled && e.buttons === 1 && !e.ctrlKey) {\n                this.setFirstCell(e);\n            }\n        });\n        root.addEventListener('mouseover', (e) => {\n            if (this.enabled) {\n                this.setActiveCell(e.composedPath().find((i) => Array.from(this.host.cells).includes(i)));\n            }\n        });\n        root.addEventListener('mouseup', () => {\n            if (this.enabled) {\n                this.stopSelection();\n            }\n        });\n    }\n    setupKeyboardListeners() {\n        this.host.addEventListener('cdsKeyChange', (e) => {\n            if (this.enabled && e.detail.code) {\n                this.setActiveCell(e.detail.activeItem);\n                if (!e.detail.shiftKey) {\n                    this.stopSelection();\n                    this.resetAllActiveCells();\n                    this.host.dispatchEvent(new CustomEvent('rangeSelectionChange', { detail: [] }));\n                }\n            }\n        });\n        this.host.addEventListener('keydown', (e) => {\n            if (this.enabled && e.code === 'ShiftLeft' && e.shiftKey && !this.selectionActive) {\n                this.setFirstCell(e);\n            }\n        });\n    }\n    setFirstCell(e) {\n        const firstCell = e.composedPath().find((i) => Array.from(this.host.cells).includes(i));\n        if (firstCell) {\n            this.firstCell = firstCell;\n            this.selectionActive = true;\n            this.resetAllActiveCells();\n        }\n    }\n    setActiveCell(activeCell) {\n        if (activeCell && this.selectionActive) {\n            this.activeCell = activeCell;\n            this.calculateSelection();\n        }\n    }\n    stopSelection() {\n        this.selectionActive = false;\n    }\n    resetAllActiveCells() {\n        this.host.cells.forEach(cell => cell.removeAttribute('highlight'));\n    }\n    calculateSelection() {\n        const x1 = parseInt(this.firstCell.ariaColIndex);\n        const x2 = parseInt(this.activeCell.ariaColIndex);\n        const y1 = parseInt(this.firstCell.parentElement?.ariaRowIndex);\n        const y2 = parseInt(this.activeCell.parentElement?.ariaRowIndex);\n        this.resetAllActiveCells();\n        this.host.cells.forEach((cell) => {\n            const colIndex = parseInt(cell.ariaColIndex);\n            const rowIndex = parseInt(cell.parentElement?.ariaRowIndex);\n            if ((x1 <= x2 && colIndex >= x1 && colIndex <= x2) || (x1 >= x2 && colIndex <= x1 && colIndex >= x2)) {\n                if ((y1 <= y2 && rowIndex >= y1 && rowIndex <= y2) || (y1 >= y2 && rowIndex <= y1 && rowIndex >= y2)) {\n                    cell.setAttribute('highlight', '');\n                }\n            }\n        });\n        this.host.dispatchEvent(new CustomEvent('rangeSelectionChange', {\n            detail: Array.from(this.host.cells).filter(c => c.hasAttribute('highlight')),\n        }));\n    }\n}\n"],"names":["gridRangeSelection","target","addInitializer","instance","GridRangeSelectionController","constructor","host","this","selectionActive","addController","enabled","rangeSelection","Array","from","rows","find","r","draggable","async","updateComplete","setupKeyboardListeners","setupMouseEvents","root","grid","shadowRoot","addEventListener","e","buttons","ctrlKey","setFirstCell","setActiveCell","composedPath","i","cells","includes","stopSelection","detail","code","activeItem","shiftKey","resetAllActiveCells","dispatchEvent","CustomEvent","firstCell","activeCell","calculateSelection","forEach","cell","removeAttribute","x1","parseInt","ariaColIndex","x2","y1","parentElement","ariaRowIndex","y2","colIndex","rowIndex","setAttribute","filter","c","hasAttribute"],"mappings":"AAQO,SAASA,IACZ,OAAQC,GAAWA,EAAOC,gBAAgBC,GAAa,IAAIC,EAA6BD,KAErF,MAAMC,EACTC,YAAYC,GACRC,KAAKD,KAAOA,EACZC,KAAKC,iBAAkB,EACvBF,EAAKG,cAAcF,MAEnBG,cACA,OAAoC,IAA7BH,KAAKD,KAAKK,iBAA6BC,MAAMC,KAAKN,KAAKD,KAAKQ,MAAMC,MAAKC,GAAKA,EAAEC,YAEzFC,4BACUX,KAAKD,KAAKa,eAChBZ,KAAKa,yBACLb,KAAKc,mBAETA,mBACI,MAAMC,EAAOf,KAAKD,KAAKiB,KAAKC,WAAajB,KAAKD,KAAKiB,KAAKC,WAAajB,KAAKD,KAAKiB,KAC/ED,EAAKG,iBAAiB,aAAcC,IAE5BnB,KAAKG,SAAyB,IAAdgB,EAAEC,UAAkBD,EAAEE,SACtCrB,KAAKsB,aAAaH,MAG1BJ,EAAKG,iBAAiB,aAAcC,IAC5BnB,KAAKG,SACLH,KAAKuB,cAAcJ,EAAEK,eAAehB,MAAMiB,GAAMpB,MAAMC,KAAKN,KAAKD,KAAK2B,OAAOC,SAASF,SAG7FV,EAAKG,iBAAiB,WAAW,KACzBlB,KAAKG,SACLH,KAAK4B,mBAIjBf,yBACIb,KAAKD,KAAKmB,iBAAiB,gBAAiBC,IACpCnB,KAAKG,SAAWgB,EAAEU,OAAOC,OACzB9B,KAAKuB,cAAcJ,EAAEU,OAAOE,YACvBZ,EAAEU,OAAOG,WACVhC,KAAK4B,gBACL5B,KAAKiC,sBACLjC,KAAKD,KAAKmC,cAAc,IAAIC,YAAY,uBAAwB,CAAEN,OAAQ,WAItF7B,KAAKD,KAAKmB,iBAAiB,WAAYC,IAC/BnB,KAAKG,SAAsB,cAAXgB,EAAEW,MAAwBX,EAAEa,WAAahC,KAAKC,iBAC9DD,KAAKsB,aAAaH,MAI9BG,aAAaH,GACT,MAAMiB,EAAYjB,EAAEK,eAAehB,MAAMiB,GAAMpB,MAAMC,KAAKN,KAAKD,KAAK2B,OAAOC,SAASF,KAChFW,IACApC,KAAKoC,UAAYA,EACjBpC,KAAKC,iBAAkB,EACvBD,KAAKiC,uBAGbV,cAAcc,GACNA,GAAcrC,KAAKC,kBACnBD,KAAKqC,WAAaA,EAClBrC,KAAKsC,sBAGbV,gBACI5B,KAAKC,iBAAkB,EAE3BgC,sBACIjC,KAAKD,KAAK2B,MAAMa,SAAQC,GAAQA,EAAKC,gBAAgB,eAEzDH,qBACI,MAAMI,EAAKC,SAAS3C,KAAKoC,UAAUQ,cAC7BC,EAAKF,SAAS3C,KAAKqC,WAAWO,cAC9BE,EAAKH,SAAS3C,KAAKoC,UAAUW,eAAeC,cAC5CC,EAAKN,SAAS3C,KAAKqC,WAAWU,eAAeC,cACnDhD,KAAKiC,sBACLjC,KAAKD,KAAK2B,MAAMa,SAASC,IACrB,MAAMU,EAAWP,SAASH,EAAKI,cACzBO,EAAWR,SAASH,EAAKO,eAAeC,eACzCN,GAAMG,GAAMK,GAAYR,GAAMQ,GAAYL,GAAQH,GAAMG,GAAMK,GAAYR,GAAMQ,GAAYL,KACxFC,GAAMG,GAAME,GAAYL,GAAMK,GAAYF,GAAQH,GAAMG,GAAME,GAAYL,GAAMK,GAAYF,IAC7FT,EAAKY,aAAa,YAAa,OAI3CpD,KAAKD,KAAKmC,cAAc,IAAIC,YAAY,uBAAwB,CAC5DN,OAAQxB,MAAMC,KAAKN,KAAKD,KAAK2B,OAAO2B,QAAOC,GAAKA,EAAEC,aAAa"}