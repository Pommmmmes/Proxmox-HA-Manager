{"version":3,"file":"inline-focus-trap.controller.js","sources":["../../../../src/internal/controllers/inline-focus-trap.controller.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\nimport { html } from 'lit';\nimport { getFlattenedFocusableItems } from '../utils/traversal.js';\nimport { renderAfter, renderBefore } from '../utils/lit.js';\nimport { ignoreFocus } from '../utils/focus.js';\n/**\n * Focus Trap that given a DOM element creates a flattened tree traversal\n * between both Shadow DOM and Light DOM\n *\n * safari https://bugs.webkit.org/show_bug.cgi?id=174667\n */\nexport function focusTrap() {\n    return (target) => target.addInitializer((instance) => new InlineFocusTrapController(instance));\n}\nexport class InlineFocusTrapController {\n    constructor(host) {\n        this.host = host;\n        this.host.addController(this);\n    }\n    get focusableItems() {\n        return getFlattenedFocusableItems(this.root).filter(e => !e.hasAttribute('cds-focus-boundary') && (this.root.contains(e) || e.closest('[cds-focus-trap]') === this.host));\n    }\n    get root() {\n        return (this.host.shadowRoot ? this.host.shadowRoot : this.host);\n    }\n    get styles() {\n        return html `<style cds-focus-style>\n      :host(:host:focus-within) [cds-focus-boundary],\n      :host(:focus-within) [cds-focus-boundary] {\n        display: block !important;\n      }\n    </style>`;\n    }\n    boundary(index) {\n        return html `<div\n      @focusin=${() => this.focusableItems.at(index)?.focus()}\n      test=${index}\n      cds-focus-boundary\n      tabindex=\"0\"\n      style=\"display:none;position:absolute;width:1px;height:1px;clip:rect(0,0,0,0)\"\n    >\n      boundary\n    </div>`;\n    }\n    async hostConnected() {\n        await this.host.updateComplete;\n        if (!ignoreFocus(this.host)) {\n            renderBefore(this.styles, this.root);\n            renderBefore(this.boundary(-1), this.root);\n            renderAfter(this.boundary(0), this.root);\n            this.host.setAttribute('cds-focus-trap', '');\n        }\n    }\n}\n"],"names":["focusTrap","target","addInitializer","instance","InlineFocusTrapController","constructor","host","this","addController","focusableItems","getFlattenedFocusableItems","root","filter","e","hasAttribute","contains","closest","shadowRoot","styles","html","boundary","index","at","focus","async","updateComplete","ignoreFocus","renderBefore","renderAfter","setAttribute"],"mappings":"8MAeO,SAASA,IACZ,OAAQC,GAAWA,EAAOC,gBAAgBC,GAAa,IAAIC,EAA0BD,KAElF,MAAMC,EACTC,YAAYC,GACRC,KAAKD,KAAOA,EACZC,KAAKD,KAAKE,cAAcD,MAExBE,qBACA,OAAOC,EAA2BH,KAAKI,MAAMC,QAAOC,IAAMA,EAAEC,aAAa,wBAA0BP,KAAKI,KAAKI,SAASF,IAAMA,EAAEG,QAAQ,sBAAwBT,KAAKD,QAEnKK,WACA,OAAQJ,KAAKD,KAAKW,WAAaV,KAAKD,KAAKW,WAAaV,KAAKD,KAE3DY,aACA,OAAOC,CAAK,mJAOhBC,SAASC,GACL,OAAOF,CAAK,kBACH,IAAMZ,KAAKE,eAAea,GAAGD,IAAQE,kBACzCF,mIAQTG,4BACUjB,KAAKD,KAAKmB,eACXC,EAAYnB,KAAKD,QAClBqB,EAAapB,KAAKW,OAAQX,KAAKI,MAC/BgB,EAAapB,KAAKa,UAAU,GAAIb,KAAKI,MACrCiB,EAAYrB,KAAKa,SAAS,GAAIb,KAAKI,MACnCJ,KAAKD,KAAKuB,aAAa,iBAAkB"}