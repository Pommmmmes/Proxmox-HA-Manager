{"version":3,"file":"button-submit.controller.js","sources":["../../../../src/internal/controllers/button-submit.controller.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\nimport { html } from 'lit';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { stopEvent } from '../utils/events.js';\nimport { onAnyKey } from '../utils/keycodes.js';\nimport { renderAfter } from '../utils/lit.js';\n/**\n * Shim for allowing native submit type events with custom element buttons as Safari prevents use of extending native element types\n */\nexport function buttonSubmit() {\n    return (target) => target.addInitializer((instance) => new ButtonSubmitController(instance));\n}\nexport class ButtonSubmitController {\n    constructor(host) {\n        this.host = host;\n        this.triggerNativeButtonBehaviorHandler = this.triggerNativeButtonBehavior.bind(this);\n        this.emulateKeyBoardEventBehaviorHandler = this.emulateKeyBoardEventBehavior.bind(this);\n        this.host.addController(this);\n    }\n    hostUpdated() {\n        this.setButtonType();\n        this.setupNativeButtonBehavior();\n    }\n    setButtonType() {\n        if (!this.host.type && this.host.closest('form')) {\n            this.host.type = 'submit';\n        }\n    }\n    setupNativeButtonBehavior() {\n        if (this.host.readonly || this.host.disabled) {\n            this.host.removeEventListener('click', this.triggerNativeButtonBehaviorHandler);\n            this.host.removeEventListener('keyup', this.emulateKeyBoardEventBehaviorHandler);\n        }\n        else {\n            this.host.addEventListener('click', this.triggerNativeButtonBehaviorHandler);\n            this.host.addEventListener('keyup', this.emulateKeyBoardEventBehaviorHandler);\n        }\n    }\n    emulateKeyBoardEventBehavior(evt) {\n        onAnyKey(['enter', 'space'], evt, () => {\n            // When submitting forms with Enter key, the default submit button receives a click event from the form.\n            if (this.host.type === 'submit') {\n                this.triggerNativeButtonBehavior(evt);\n            }\n            else {\n                this.host.click();\n            }\n            stopEvent(evt);\n        });\n    }\n    /**\n     * We have to append a hidden button outside the web component in the light DOM\n     * This allows us to trigger native submit events within a form element.\n     */\n    triggerNativeButtonBehavior(event) {\n        if (this.host.disabled) {\n            stopEvent(event);\n        }\n        else if (!event.defaultPrevented) {\n            const submitButton = renderAfter(html `<button\n          aria-hidden=\"true\"\n          role=\"presentation\"\n          ?disabled=\"${this.host.disabled}\"\n          tabindex=\"-1\"\n          style=\"display: none !important\"\n          value=\"${ifDefined(this.host.value)}\"\n          name=\"${ifDefined(this.host.name)}\"\n          type=\"${ifDefined(this.host.type)}\"\n        ></button>`, this.host);\n            submitButton?.dispatchEvent(new MouseEvent('click', { relatedTarget: this.host, composed: true }));\n            submitButton?.remove();\n        }\n    }\n}\n"],"names":["buttonSubmit","target","addInitializer","instance","ButtonSubmitController","constructor","host","this","triggerNativeButtonBehaviorHandler","triggerNativeButtonBehavior","bind","emulateKeyBoardEventBehaviorHandler","emulateKeyBoardEventBehavior","addController","hostUpdated","setButtonType","setupNativeButtonBehavior","type","closest","readonly","disabled","removeEventListener","addEventListener","evt","onAnyKey","click","stopEvent","event","defaultPrevented","submitButton","renderAfter","html","ifDefined","value","name","dispatchEvent","MouseEvent","relatedTarget","composed","remove"],"mappings":"iOAaO,SAASA,IACZ,OAAQC,GAAWA,EAAOC,gBAAgBC,GAAa,IAAIC,EAAuBD,KAE/E,MAAMC,EACTC,YAAYC,GACRC,KAAKD,KAAOA,EACZC,KAAKC,mCAAqCD,KAAKE,4BAA4BC,KAAKH,MAChFA,KAAKI,oCAAsCJ,KAAKK,6BAA6BF,KAAKH,MAClFA,KAAKD,KAAKO,cAAcN,MAE5BO,cACIP,KAAKQ,gBACLR,KAAKS,4BAETD,iBACSR,KAAKD,KAAKW,MAAQV,KAAKD,KAAKY,QAAQ,UACrCX,KAAKD,KAAKW,KAAO,UAGzBD,4BACQT,KAAKD,KAAKa,UAAYZ,KAAKD,KAAKc,UAChCb,KAAKD,KAAKe,oBAAoB,QAASd,KAAKC,oCAC5CD,KAAKD,KAAKe,oBAAoB,QAASd,KAAKI,uCAG5CJ,KAAKD,KAAKgB,iBAAiB,QAASf,KAAKC,oCACzCD,KAAKD,KAAKgB,iBAAiB,QAASf,KAAKI,sCAGjDC,6BAA6BW,GACzBC,EAAS,CAAC,QAAS,SAAUD,GAAK,KAEP,WAAnBhB,KAAKD,KAAKW,KACVV,KAAKE,4BAA4Bc,GAGjChB,KAAKD,KAAKmB,QAEdC,EAAUH,MAOlBd,4BAA4BkB,GACxB,GAAIpB,KAAKD,KAAKc,SACVM,EAAUC,QAET,IAAKA,EAAMC,iBAAkB,CAC9B,MAAMC,EAAeC,EAAYC,CAAK,6DAG3BxB,KAAKD,KAAKc,iEAGdY,EAAUzB,KAAKD,KAAK2B,iBACrBD,EAAUzB,KAAKD,KAAK4B,gBACpBF,EAAUzB,KAAKD,KAAKW,mBACjBV,KAAKD,MACduB,GAAcM,cAAc,IAAIC,WAAW,QAAS,CAAEC,cAAe9B,KAAKD,KAAMgC,UAAU,KAC1FT,GAAcU"}