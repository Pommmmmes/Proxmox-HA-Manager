{"version":3,"file":"layer.controller.js","sources":["../../../../src/internal/controllers/layer.controller.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\nimport { listenForAttributeChange } from '../utils/events.js';\nimport { GlobalStateService } from '../services/global.service.js';\n/**\n * LayerController provides manage layer tracking for components. Ensures any component\n * that may be a layer on top of other components is given a ordered index relative\n * to other existing layers on the page.\n *\n * This makes layer tracking easier for CSS, such as targeting the top or bottom\n * layer element or setting a z-index ordering.\n */\nexport function layer() {\n    return (target) => {\n        target.addInitializer((instance) => {\n            if (!instance.layerController) {\n                instance.layerController = new LayerController(instance);\n            }\n        });\n    };\n}\nexport class LayerController {\n    constructor(host) {\n        this.host = host;\n        this.host.addController(this);\n    }\n    get isActiveLayer() {\n        return this.layers[this.layers.length - 1] === this.host;\n    }\n    get layerIndex() {\n        const index = this.layers.indexOf(this.host);\n        return index === -1 ? null : index;\n    }\n    get layers() {\n        return [...GlobalStateService.state.layerElements];\n    }\n    set layers(layers) {\n        GlobalStateService.state.layerElements = [...layers];\n    }\n    hostConnected() {\n        if (!this.host.hasAttribute('_demo-mode')) {\n            this.updateLayer();\n            this.observer = listenForAttributeChange(this.host, 'hidden', () => this.updateLayer());\n        }\n    }\n    hostDisconnected() {\n        this.observer?.disconnect();\n        this.removeLayer();\n    }\n    updateLayer() {\n        if (this.host.hasAttribute('hidden')) {\n            this.removeLayer();\n        }\n        else {\n            this.addLayer();\n        }\n        this.layers.forEach((layer, i) => layer.setAttribute('cds-layer', `${i}`));\n    }\n    addLayer() {\n        if (!this.layers.find(layer => this.host === layer)) {\n            this.layers = [...this.layers, this.host];\n            // We do this so that screen-readers can make their way through nested/layered overlays.\n            // It sets a virtual cursor trap on the top-most overlay.\n            if (this.host.ariaModal === 'true') {\n                this.layers.filter(layer => layer.ariaModal === 'true').forEach(layer => (layer.role = 'region'));\n                this.host.role = 'dialog';\n            }\n        }\n    }\n    removeLayer() {\n        this.layers = this.layers.filter(layer => layer !== this.host);\n        this.host.removeAttribute('cds-layer');\n        const nextModal = this.layers.find(layer => layer.ariaModal === 'true');\n        if (nextModal) {\n            nextModal.role = 'dialog';\n        }\n    }\n}\n"],"names":["layer","target","addInitializer","instance","layerController","LayerController","constructor","host","this","addController","isActiveLayer","layers","length","layerIndex","index","indexOf","GlobalStateService","state","layerElements","hostConnected","hasAttribute","updateLayer","observer","listenForAttributeChange","hostDisconnected","disconnect","removeLayer","addLayer","forEach","i","setAttribute","find","ariaModal","filter","role","removeAttribute","nextModal"],"mappings":"iIAeO,SAASA,IACZ,OAAQC,IACJA,EAAOC,gBAAgBC,IACdA,EAASC,kBACVD,EAASC,gBAAkB,IAAIC,EAAgBF,QAKxD,MAAME,EACTC,YAAYC,GACRC,KAAKD,KAAOA,EACZC,KAAKD,KAAKE,cAAcD,MAExBE,oBACA,OAAOF,KAAKG,OAAOH,KAAKG,OAAOC,OAAS,KAAOJ,KAAKD,KAEpDM,iBACA,MAAMC,EAAQN,KAAKG,OAAOI,QAAQP,KAAKD,MACvC,OAAkB,IAAXO,EAAe,KAAOA,EAE7BH,aACA,MAAO,IAAIK,EAAmBC,MAAMC,eAEpCP,WAAOA,GACPK,EAAmBC,MAAMC,cAAgB,IAAIP,GAEjDQ,gBACSX,KAAKD,KAAKa,aAAa,gBACxBZ,KAAKa,cACLb,KAAKc,SAAWC,EAAyBf,KAAKD,KAAM,UAAU,IAAMC,KAAKa,iBAGjFG,mBACIhB,KAAKc,UAAUG,aACfjB,KAAKkB,cAETL,cACQb,KAAKD,KAAKa,aAAa,UACvBZ,KAAKkB,cAGLlB,KAAKmB,WAETnB,KAAKG,OAAOiB,SAAQ,CAAC5B,EAAO6B,IAAM7B,EAAM8B,aAAa,YAAa,GAAGD,KAEzEF,WACSnB,KAAKG,OAAOoB,MAAK/B,GAASQ,KAAKD,OAASP,MACzCQ,KAAKG,OAAS,IAAIH,KAAKG,OAAQH,KAAKD,MAGR,SAAxBC,KAAKD,KAAKyB,YACVxB,KAAKG,OAAOsB,QAAOjC,GAA6B,SAApBA,EAAMgC,YAAsBJ,SAAQ5B,GAAUA,EAAMkC,KAAO,WACvF1B,KAAKD,KAAK2B,KAAO,WAI7BR,cACIlB,KAAKG,OAASH,KAAKG,OAAOsB,QAAOjC,GAASA,IAAUQ,KAAKD,OACzDC,KAAKD,KAAK4B,gBAAgB,aAC1B,MAAMC,EAAY5B,KAAKG,OAAOoB,MAAK/B,GAA6B,SAApBA,EAAMgC,YAC9CI,IACAA,EAAUF,KAAO"}