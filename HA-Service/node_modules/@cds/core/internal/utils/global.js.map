{"version":3,"file":"global.js","sources":["../../../../src/internal/utils/global.ts"],"sourcesContent":["/*\n * Copyright (c) 2016-2023 VMware, Inc. All Rights Reserved.\n * This software is released under MIT license.\n * The full license information can be found in LICENSE in the root directory of this project.\n */\nimport { isBrowser } from './environment.js';\nimport { getAngularVersion, getReactVersion, getVueVersion, getAngularJSVersion } from './framework.js';\nimport { browserFeatures } from './supports.js';\nimport { LogService } from '../services/log.service.js';\nexport function setupCDSGlobal() {\n    if (isBrowser()) {\n        initializeCDSGlobal();\n        setRunningVersion();\n        intializeCDSStateProxy();\n    }\n}\nfunction intializeCDSStateProxy() {\n    if (!window.CDS._isStateProxied) {\n        window.CDS._isStateProxied = true;\n        window.CDS._state = new Proxy(window.CDS._state, {\n            set: (target, key, value) => {\n                const detail = { key, prev: window.CDS._state[key], current: value };\n                target[key] = value;\n                document.dispatchEvent(new CustomEvent('CDS_STATE_UPDATE', { detail }));\n                return true;\n            },\n        });\n    }\n}\nfunction getDetails() {\n    return {\n        versions: window.CDS._version,\n        environment: window.CDS.environment,\n        userAgent: navigator.userAgent,\n        supports: window.CDS._supports,\n        angularVersion: getAngularVersion(false),\n        angularJSVersion: getAngularJSVersion(false),\n        reactVersion: getReactVersion(false),\n        vueVersion: getVueVersion(false),\n        state: {\n            ...window.CDS._state,\n            iconRegistry: Object.keys(window.CDS._state.iconRegistry),\n            motionRegistry: Object.keys(window.CDS._state.motionRegistry),\n            focusTrapRegistry: Object.keys(window.CDS._state.focusTrapItems.map(i => i.focusTrapId)),\n        },\n    };\n}\nfunction logDetails() {\n    LogService.log(JSON.stringify(getDetails(), null, 2));\n}\nfunction initializeCDSGlobal() {\n    window.CDS = window.CDS || {\n        _version: [],\n        _react: { version: undefined },\n        _supports: browserFeatures.supports,\n        _isStateProxied: false,\n        _state: {\n            focusTrapItems: [],\n            layerElements: [],\n            i18nRegistry: {},\n            elementRegistry: {},\n            iconRegistry: {},\n            motionRegistry: {},\n        },\n        environment: {\n            production: false,\n        },\n        getDetails,\n        logDetails,\n    };\n}\nfunction setRunningVersion() {\n    const loadedVersion = 'PACKAGE_VERSION';\n    if (window.CDS._version.indexOf(loadedVersion) < 0) {\n        window.CDS._version.push(loadedVersion);\n        document.querySelector('body')?.setAttribute('cds-version', window.CDS._version.join(' '));\n    }\n    if (window.CDS._version.length > 1) {\n        LogService.warn('Running more than one version of Clarity can cause unexpected issues. Please ensure only one version is loaded.');\n    }\n}\n"],"names":["setupCDSGlobal","isBrowser","window","CDS","_version","_react","version","undefined","_supports","browserFeatures","supports","_isStateProxied","_state","focusTrapItems","layerElements","i18nRegistry","elementRegistry","iconRegistry","motionRegistry","environment","production","getDetails","logDetails","loadedVersion","indexOf","push","document","querySelector","setAttribute","join","length","LogService","warn","setRunningVersion","Proxy","set","target","key","value","detail","prev","current","dispatchEvent","CustomEvent","versions","userAgent","navigator","angularVersion","getAngularVersion","angularJSVersion","getAngularJSVersion","reactVersion","getReactVersion","vueVersion","getVueVersion","state","Object","keys","focusTrapRegistry","map","i","focusTrapId","log","JSON","stringify"],"mappings":"yQASO,SAASA,IACRC,MAyCJC,OAAOC,IAAMD,OAAOC,KAAO,CACvBC,SAAU,GACVC,OAAQ,CAAEC,aAASC,GACnBC,UAAWC,EAAgBC,SAC3BC,iBAAiB,EACjBC,OAAQ,CACJC,eAAgB,GAChBC,cAAe,GACfC,aAAc,GACdC,gBAAiB,GACjBC,aAAc,GACdC,eAAgB,IAEpBC,YAAa,CACTC,YAAY,GAEhBC,WAAAA,EACAC,WAAAA,GAGR,WACI,MAAMC,EAAgB,kBAClBrB,OAAOC,IAAIC,SAASoB,QAAQD,GAAiB,IAC7CrB,OAAOC,IAAIC,SAASqB,KAAKF,GACzBG,SAASC,cAAc,SAASC,aAAa,cAAe1B,OAAOC,IAAIC,SAASyB,KAAK,OAErF3B,OAAOC,IAAIC,SAAS0B,OAAS,GAC7BC,EAAWC,KAAK,mHAlEhBC,GAKC/B,OAAOC,IAAIQ,kBACZT,OAAOC,IAAIQ,iBAAkB,EAC7BT,OAAOC,IAAIS,OAAS,IAAIsB,MAAMhC,OAAOC,IAAIS,OAAQ,CAC7CuB,IAAK,CAACC,EAAQC,EAAKC,KACf,MAAMC,EAAS,CAAEF,IAAAA,EAAKG,KAAMtC,OAAOC,IAAIS,OAAOyB,GAAMI,QAASH,GAG7D,OAFAF,EAAOC,GAAOC,EACdZ,SAASgB,cAAc,IAAIC,YAAY,mBAAoB,CAAEJ,OAAAA,MACtD,OAKvB,SAASlB,IACL,MAAO,CACHuB,SAAU1C,OAAOC,IAAIC,SACrBe,YAAajB,OAAOC,IAAIgB,YACxB0B,UAAWC,UAAUD,UACrBnC,SAAUR,OAAOC,IAAIK,UACrBuC,eAAgBC,GAAkB,GAClCC,iBAAkBC,GAAoB,GACtCC,aAAcC,GAAgB,GAC9BC,WAAYC,GAAc,GAC1BC,MAAO,IACArD,OAAOC,IAAIS,OACdK,aAAcuC,OAAOC,KAAKvD,OAAOC,IAAIS,OAAOK,cAC5CC,eAAgBsC,OAAOC,KAAKvD,OAAOC,IAAIS,OAAOM,gBAC9CwC,kBAAmBF,OAAOC,KAAKvD,OAAOC,IAAIS,OAAOC,eAAe8C,KAAIC,GAAKA,EAAEC,iBAIvF,SAASvC,IACLS,EAAW+B,IAAIC,KAAKC,UAAU3C,IAAc,KAAM"}